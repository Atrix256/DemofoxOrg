<!DOCTYPE html>
<html>
<head>

<style type="text/css">
body { color: #00FF00; background-color:black;}
canvas#RenderWindow {border:2px solid #00FF00;width:700px; height:700px;}
table {
    border-collapse: collapse;
}
table, td {
    border: 1px solid #00FF00;
}
table.NoBorder td {
    border: 1px solid black;
}
</style>

<script type="module">

    let exports = null;
    let graphWidth = 0;
    let graphHeight = 0;

    function DrawGraph()
    {
        var canvas = document.getElementById('canvas');
        var ctx = canvas.getContext('2d');

        const heights = new Uint8Array(exports.memory.buffer, exports.GetGraphHeights());

        // TODO: this is slower, get rid of it?
        if (false)
        {
            ctx.lineWidth = 1;
            ctx.strokeStyle = '#00FF00';
            //ctx.setLineDash([10, 5]);

            ctx.moveTo(0, canvas.height - heights[0] - 1);

            for (var i = 1; i < heights.length; i++)
              ctx.lineTo(i, canvas.height - heights[i] - 1);

            ctx.closePath();
            ctx.stroke();
        }
        else
        {
            var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            var data = imageData.data;

            for (var i = 0; i < data.length; i += 4)
            {
                var pixelIndex = i / 4;

                var x = pixelIndex % canvas.width;
                var y = canvas.height - (pixelIndex / canvas.width) - 1; // flip y over

                if (y < heights[x])
                {
                    data[i + 0] = 0;
                    data[i + 1] = 255;
                }
                else
                {
                    data[i + 0] = 0;
                    data[i + 1] = 0;
                }

                data[i + 2] = 0;
                data[i + 3] = 255;
            }

            ctx.putImageData(imageData, 0, 0);
        }
    }

    async function init()
    {
        const { instance } = await WebAssembly.instantiateStreaming(fetch("hello.wasm"));

        exports = instance.exports;

        graphWidth = exports.GetGraphWidth();
        graphHeight = exports.GetGraphHeight();

        document.getElementById('canvas').width = graphWidth;
        document.getElementById('canvas').height = graphHeight;

        DrawGraph();

        // TODO: this. DrawGraph()?
        //  requestAnimationFrame(DrawScene);
    }

    init();
</script>

</head>
<body>

<input type="range" min="0" max="100" id="A0Value" value="0" oninput="document.getElementById('A0Label').innerText='A0: ' + this.value;"/>
<span id="A0Label">A0: 0</span>
<br>

<input type="range" min="0" max="100" id="A1Value" value="0" oninput="document.getElementById('A1Label').innerText='A1: ' + this.value;"/>
<span id="A1Label">A1: 0</span>
<br>

<input type="range" min="0" max="100" id="A2Value" value="0" oninput="document.getElementById('A2Label').innerText='A2: ' + this.value;"/>
<span id="A2Label">A2: 0</span>
<br>

<canvas id="canvas" style="image-rendering: pixelated; border: 1px solid #00FF00;"></canvas>

</body>
</html>
